<script>
document.addEventListener("DOMContentLoaded", function() {
    const display = document.getElementById("display");
    const mini = document.getElementById("mini-calc");
    const calc = document.getElementById("calculator");

    // BUTTON FUNCTIONS
    function press(val){ display.value += val; }
    function clearDisplay(){ display.value = ""; }
    function backspace(){ display.value = display.value.slice(0,-1); }

    // CALCULATE FUNCTION
    function calculate(){
        if(display.value.trim() === "") return;
        fetch("/calculate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ expression: display.value })
        })
        .then(res => res.json())
        .then(data => {
            display.value = data.result || "Error";
        })
        .catch(() => display.value = "Error");
    }

    // Attach to window for HTML button onclick
    window.press = press;
    window.clearDisplay = clearDisplay;
    window.backspace = backspace;
    window.calculate = calculate;

    // MINI CALC ANIMATION FLOW
    setTimeout(()=> mini.classList.add("expand"), 2000);
    setTimeout(()=>{
        mini.remove();
        calc.classList.remove("hidden");
    }, 2600);
});
</script>
